FROM node:16.13-alpine

WORKDIR /app
COPY package.json .
RUN npm install -g yarn
RUN yarn install
RUN yarn build
COPY . .

ARG DATABASE_URL
ARG GOOGLE_AUTH_CLIENT_ID
ARG GOOGLE_AUTH_CLIENT_SECRET
ARG JWT_ACCESS_TOKEN_EXPIRATION_TIME_SECONDS
ARG JWT_REFRESH_TOKEN_EXPIRATION_TIME_SECONDS
ARG JWT_AUDIENCE
ARG JWK_PUB_AND_PRIV_KEYSET_BASE64
ARG CLIENT_APP_URL
ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_KMS_KEY_ID

CMD yarn run start:prod
